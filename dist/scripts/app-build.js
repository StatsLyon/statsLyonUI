"bundle";!function(){var a=System.amdDefine;a("app.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <require from="component/core/nav-bar.html"></require>\n  <require from="humane-js/themes/flatty.css"></require>\n\n  <nav-bar router.bind="router"></nav-bar>\n\n  <router-view></router-view>\n</template>\n'})}(),System.register("app.js",["aurelia-framework","aurelia-router"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a.Router}],execute:function(){a("App",(f=d(e),h=f(g=function a(b){c(this,a),this.router=b})||g)),a("App",h)}}}),function(){var a=System.amdDefine;a("component/chart.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div element.ref="chart" class="chart"></div>\n</template>\n'})}(),System.register("component/chart.js",["aurelia-framework","c3"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p;return{setters:[function(a){f=a.inject,g=a.bindable,h=a.customElement,i=a.bindingMode},function(a){j=a.default}],execute:function(){a("Chart",(k=h("chart"),l=g({defaultBindingMode:i.twoWay}),p=k((n=function(){function a(){d(this,a),c(this,"settings",o,this),this.instance=null,this.chart=null}return a.prototype.setupBinding=function(){this.settings.bindto=this.chart},a.prototype.generate=function(){this.instance=j.generate(this.settings)},a.prototype.create=function(){this.setupBinding(),this.generate()},a.prototype.reload=function(){var a=this;this.instance.unload({done:function(){a.instance.load(a.settings.data)}})},a.prototype.redraw=function(){this.instance.flush()},a.prototype.addYGridLine=function(a){this.instance.ygrids.add(a),this.redraw()},a.prototype.removeYGrids=function(){this.instance.ygrids.remove()},a.prototype.setExtent=function(a){this.instance.zoom(a)},a}(),o=e(n.prototype,"settings",[l],{enumerable:!0,initializer:null}),m=n))||m)),a("Chart",p)}}}),function(){var a=System.amdDefine;a("component/core/nav-bar.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template bindable="router">\n  <nav class="navbar navbar-dark bg-inverse">\n    <div class="clearfix">\n      <button class="navbar-toggler pull-xs-right hidden-sm-up" type="button" data-toggle="collapse"\n              data-target="#collapsingNavbar" aria-controls="collapsingNavbar" aria-expanded="true"\n              aria-label="Toggle navigation">â˜°</button>\n      <a class="navbar-brand hidden-sm-up" href="/#/">StatsLyon</a>\n    </div>\n    <div class="collapse navbar-toggleable-xs" id="collapsingNavbar">\n      <ul class="nav navbar-nav">\n        <li repeat.for="row of router.navigation" class="nav-item ${row.isActive ? \'active\' : \'\'}">\n          <a class="nav-link" href.bind="row.href"><span t="${row.title}"></span></a>\n        </li>\n      </ul>\n    </div>\n  </nav>\n</template>\n'})}(),function(){var a=System.amdDefine;a("component/datamap.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div class="container map">\n\n    <div class="controls">\n      <button class="fullscreen button float-xs-right" type="submit" click.delegate="fullscreen()">\n        <i class="fa fa-white fa-inverse fa-arrows-alt"></i>\n      </button>\n      <button class="minus button float-xs-right" type="submit" click.delegate="zoomIn()">\n        <i class="fa fa-white fa-inverse fa-minus"></i>\n      </button>\n      <button class="plus button float-xs-right" type="submit" click.delegate="zoomOut()">\n        <i class="fa fa-white fa-inverse fa-plus"></i>\n      </button>\n      <div class="station-selector float-xs-left">\n        <input\n          class="time-selector"\n          type="range"\n          value.bind="stationSelected"\n          min="0"\n          max.bind="stationsStats.length - 1"\n          step="1"\n        />\n        <span class="time-selector-value">${stationsStats[stationSelected].key_as_string | hourFormat}</span>\n      </div>\n    </div>\n\n    <tooltip view-model.ref="tooltip"></tooltip>\n\n    <div class="svg-container" ref="svgContainer">\n      <svg element.ref="svgElement"></svg>\n    </div>\n\n  </div>\n</template>\n'})}(),System.register("component/datamap.js",["aurelia-framework","aurelia-api","aurelia-pal","d3","remove-accents","homefront","screenfull"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}function f(a){return n(a).toLowerCase().replace(/ /g,"")}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;return{setters:[function(a){g=a.inject,h=a.customElement,i=a.bindable,j=a.observable},function(a){k=a.Endpoint},function(a){l=a.DOM},function(a){m=a},function(a){n=a.default},function(a){o=a.Homefront},function(a){p=a.default}],execute:function(){a("Datamap",(q=h("datamap"),r=g(k.of("api")),s=j(),t=j(),u=j(),v=i(),w=i(),x=i(),y=i(),z=j(),K=q(A=r((B=function(){function a(b){var e=this;d(this,a),c(this,"width",C,this),this.height=650,c(this,"featureCollection",D,this),c(this,"stats",E,this),c(this,"file",F,this),c(this,"dataset",G,this),c(this,"stationsStats",H,this),c(this,"colorRange",I,this),c(this,"stationSelected",J,this),this.projection=null,this.path=null,this.map=null,this.svgContainer=null,this.svgElement=null,this.endpoint=b,this.windowResizeEventHandler=function(){e.setSize()}}return a.prototype.stationSelectedChanged=function(){this.reloadMap()},a.prototype.widthChanged=function(){this.reloadMap()},a.prototype.featureCollectionChanged=function(){this.setSize()},a.prototype.setSize=function(){this.height=this.svgContainer.clientHeight,this.width=this.svgContainer.clientWidth},a.prototype.showTooltip=function(a){this.tooltip.setValue(a.properties.prettyName),this.tooltip.setPosition({x:m.event.layerX,y:m.event.layerY},this.width),this.tooltip.show()},a.prototype.hideTooltip=function(){this.tooltip.hide()},a.prototype.reloadMap=function(){this.draw()},a.prototype.zoom=function(){this.mapVectors.attr("transform","translate("+m.event.transform.x+" "+m.event.transform.y+")scale("+m.event.transform.k+")"),this.stationsVectors.attr("transform","translate("+m.event.transform.x+" "+m.event.transform.y+")scale("+m.event.transform.k+")")},a.prototype.setupMap=function(){this.map&&m.select(this.svgElement).selectAll("*").remove(),this.projection=m.geoMercator(),this.projection.center([9,45]).scale(1e3).translate([this.width/2,this.height/2]),this.path=m.geoPath().projection(this.projection),this.zoomBehavior=m.zoom().duration(750).scaleExtent([1,10]).translateExtent([[0,0],[this.width,this.height]]).on("zoom",this.zoom.bind(this)),this.map=m.select(this.svgElement).attr("width",this.width).attr("height",this.height).append("g").call(this.zoomBehavior),this.mapVectors=this.map.append("g").attr("class","polygon"),this.stationsVectors=this.map.append("g").attr("class","polygon"),this.projection.scale(1).translate([0,0])},a.prototype.setProjection=function(){var a=this.path.bounds(this.featureCollection),b=a[0][0],c=a[1][0],d=a[0][1],e=a[1][1],f=Math.max((c-b)/this.width,(e-d)/this.height),g=.95,h=g/f,i=(this.width-h*(c+b))/2,j=(this.height-h*(d+e))/2,k=[i,j];this.projection.scale(h).translate(k)},a.prototype.setColorScale=function(){var a=this,b=m.min(this.featureCollection.features,function(b){var c=f(b.properties.prettyName);if(a.dataset.data[c])return a.dataset.data[c].sum.value}),c=m.max(this.featureCollection.features,function(b){var c=f(b.properties.prettyName);if(a.dataset.data[c])return a.dataset.data[c].sum.value});this.colorScale=m.scaleQuantize().domain([b,c]).range(this.colorRange)},a.prototype.drawLegend=function(){var a=this,b=20,c=7,d=this.map.append("g").attr("class","legend"),e=d.append("g").attr("class","title").selectAll("title").data([this.dataset.title]).enter();e.append("text").attr("x",this.width/c).attr("y",this.height-50).attr("dy","5px").style("text-decoration","underline").text(function(a){return a});var f=d.append("g").attr("class","legendEntries").selectAll("legendEntry").data(this.colorScale.range().reverse()).enter().append("g").attr("class","legendEntry");f.append("rect").attr("x",this.width/c).attr("y",function(c,d){return a.height-80-(d+1)*b}).attr("width",b).attr("height",b).style("stroke","black").style("stroke-width",1).style("fill",function(a){return a}),f.append("text").attr("x",this.width/c+30).attr("y",function(c,d){return a.height-70-(d+1)*b}).attr("dy","5px").text(function(b){var c=a.colorScale.invertExtent(b),d=m.format("i");return d(+c[0])+" - "+d(+c[1])});var g=d.node().getBoundingClientRect(),h=this.svgElement.getBoundingClientRect(),i={top:g.top-h.top,left:g.left-h.left,width:g.width,height:g.height},j=30;d.append("rect").attr("class","legend-wrapper").style("x",i.left-j/2).style("y",i.top-j/2).style("width",i.width+j).style("height",i.height+j)},a.prototype.drawMap=function(){var a=(new o(this.dataset,o.MODE_NESTED),"#303030"),b="#121212";this.mapVectors.selectAll("path").data(this.featureCollection.features).enter().append("path").attr("id",function(a){return a.properties.gid}).attr("d",this.path).style("stroke",a).attr("fill",b)},a.prototype.drawStations=function(){var a=this,b=m.scaleLinear().domain([0,40]).range([2,9]);this.stationsVectors.selectAll("path").data(this.stationsStats[this.stationSelected].docs.hits.hits).enter().append("circle").attr("location",function(b){var c=a.projection([b._source.location.lon,b._source.location.lat]);return b.location={lat:c[0],lon:c[1]},b}).attr("cx",function(a){return a.location.lat}).attr("cy",function(a){return a.location.lon}).attr("r",function(a){return b(a._source.availableStands)}).on("mouseover",function(b){a.tooltip.setValue(b._source.availableStands),a.tooltip.setPosition({x:m.event.layerX,y:m.event.layerY},a.width),a.tooltip.show()}).on("mouseout",this.hideTooltip.bind(this)).attr("fill","#164F70")},a.prototype.draw=function(){this.setupMap(),this.setProjection(),this.drawMap(),this.drawStations()},a.prototype.fullscreen=function(){var a=document.querySelector(".map");p.enabled&&p.toggle(a),this.setSize()},a.prototype.zoomIn=function(){console.info("Zoom in"),this.map.call(this.zoomBehavior.transform,m.zoomIdentity)},a.prototype.zoomOut=function(){},a.prototype.attached=function(){var a=this;window.addEventListener("resize",this.windowResizeEventHandler),m.json(this.file,function(b,c){return b?console.error(b):(a.featureCollection=c,void(a.stationSelected=a.stationsStats.length-1))})},a.prototype.detached=function(){window.removeEventListener("resize",this.windowResizeEventHandler)},a}(),C=e(B.prototype,"width",[s],{enumerable:!0,initializer:function(){return null}}),D=e(B.prototype,"featureCollection",[t],{enumerable:!0,initializer:function(){return null}}),E=e(B.prototype,"stats",[u],{enumerable:!0,initializer:function(){return null}}),F=e(B.prototype,"file",[v],{enumerable:!0,initializer:function(){return null}}),G=e(B.prototype,"dataset",[w],{enumerable:!0,initializer:function(){return null}}),H=e(B.prototype,"stationsStats",[x],{enumerable:!0,initializer:function(){return[]}}),I=e(B.prototype,"colorRange",[y],{enumerable:!0,initializer:function(){return["#edf8e9","#bae4b3","#74c476","#238b45"]}}),J=e(B.prototype,"stationSelected",[z],{enumerable:!0,initializer:function(){return 0}}),A=B))||A)||A)),a("Datamap",K)}}}),function(){var a=System.amdDefine;a("component/datapie.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div class="card">\n    <div class="card-block" style="background: #f7ffe2;">\n      <h3 class="card-title text-md-center" style="color:#62918C;">${name}</h3>\n      <div class="svgContainer" element.ref="svgContainer">\n        <svg element.ref="svgElement"></svg>\n      </div>\n    </div>\n</template>\n'})}(),System.register("component/datapie.js",["aurelia-framework","aurelia-api","aurelia-pal","d3"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return{setters:[function(a){f=a.inject,g=a.customElement,h=a.bindable,i=a.observable},function(a){j=a.Endpoint},function(a){k=a.DOM},function(a){l=a}],execute:function(){a("Datapie",(m=g("datapie"),n=h(),o=i(),p=h(),q=h(),w=m((s=function(){function a(){var b=this;d(this,a),this.width=null,this.height=null,this.outerRadius=null,this.innerRadius=null,this.svgElement=null,c(this,"percent",t,this),this.range={min:0,max:100},c(this,"name",u,this),c(this,"fill",v,this),this.duration=500,this.CIRCLE_RADIUS=360,this.SEMI_CIRCLE_RADIUS=180,this.TAU=2*Math.PI,this.windowResizeEventHandler=function(){b.setSize().draw().update()}}return a.prototype.percentChanged=function(){this.update()},a.prototype.setSize=function(){this.height=this.svgContainer.clientHeight,this.width=this.svgContainer.clientWidth;var a=Math.min(this.height,this.width);return this.outerRadius=a/3,this.innerRadius=.8*this.outerRadius,this},a.prototype.arcTween=function(a){var b=this,c=l.interpolate(this._current,a);return this._current=c(0),function(a){return b.arc(c(a))}},a.prototype.paths=function(a){var b=this;return a.map(function(a){var c=(a-b.range.min)/(b.range.max-b.range.min)*b.CIRCLE_RADIUS,d=c*(Math.PI/b.SEMI_CIRCLE_RADIUS);return{value:a,startAngle:0,endAngle:d}})},a.prototype.update=function(){return this.circle.datum([this.percent]).selectAll("path").data(this.paths.bind(this)).transition().duration(this.duration).attrTween("d",this.arcTween.bind(this)),this.circleTitle.datum([this.percent]).selectAll("text").data(this.paths.bind(this)).text(function(a){return a.value+" %"}),this},a.prototype.draw=function(){var a=this;return this.svg&&this.svg.selectAll("*").remove(),this.arc=l.arc().innerRadius(this.innerRadius).outerRadius(this.outerRadius).startAngle(0),this.svg=l.select(this.svgElement),this.backGroundCircle=this.svg.append("g").attr("transform","translate("+this.width/2+", "+this.height/2+")"),this.backGroundCircle.append("path").datum({endAngle:this.TAU}).style("fill","#ddd").attr("d",this.arc),this.circle=this.svg.append("g").attr("transform","translate("+this.width/2+", "+this.height/2+")"),this.circle.datum([0]).selectAll("path").data(this.paths.bind(this)).enter().append("path").attr("fill",this.fill).attr("d",this.arc).each(function(b){a._current=b}),this.circleTitle=this.svg.append("g").attr("transform","translate("+this.width/2+", "+this.height/2+")"),this.circleTitle.datum([0]).selectAll("text").data(this.paths.bind(this)).enter().append("text").attr("class","percentageText").attr("font-size",this.width+" %").attr("dy",".4em").attr("text-anchor","middle").text(function(a){return a.value+" %"}),this},a.prototype.attached=function(){window.addEventListener("resize",this.windowResizeEventHandler),this.setSize(),this.draw()},a.prototype.detached=function(){window.removeEventListener("resize",this.windowResizeEventHandler)},a}(),t=e(s.prototype,"percent",[n,o],{enumerable:!0,initializer:function(){return null}}),u=e(s.prototype,"name",[p],{enumerable:!0,initializer:function(){return null}}),v=e(s.prototype,"fill",[q],{enumerable:!0,initializer:function(){return"#CD2A41"}}),r=s))||r)),a("Datapie",w)}}}),function(){var a=System.amdDefine;a("component/results.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div\n    class="autocompletion-container"\n    if.bind="display"\n  >\n    <ul id="autocompletion">\n      <li\n        class="station"\n        repeat.for="item of dataset"\n        class.bind="($index === selectedItemIndex) ? \'active\': \'\'"\n      >\n        <a\n          href="/station/${item._source.stationID}"\n          focus.bind="($index === selectedItemIndex)"\n        >\n          <span class="tag tag-info">${item._source.stationID}</span>\n          <h5>${item._source.name | titleFormat}</h5>\n        </a>\n      </li>\n    </ul>\n  </div>\n</template>\n'})}(),System.register("component/results.js",["aurelia-framework"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p;return{setters:[function(a){f=a.inject,g=a.customElement,h=a.bindable}],execute:function(){a("Results",(i=g("results"),j=h(),k=h(),p=i((m=function(){function a(){d(this,a),c(this,"dataset",n,this),c(this,"display",o,this),this.selectedItemIndex=-1}return a.prototype.datasetChanged=function(){return this.dataset?void this.show():this.hide()},a.prototype.show=function(){this.display=!0},a.prototype.hide=function(){this.display=!1},a.prototype.resetSelection=function(){this.selectedItemIndex=-1},a.prototype.selectNextItem=function(){this.selectedItemIndex+=1},a.prototype.selectPreviousItem=function(){this.selectedItemIndex-=1},a.prototype.getSelectedItemIndex=function(){return this.selectedItemIndex},a}(),n=e(m.prototype,"dataset",[j],{enumerable:!0,initializer:function(){return[]}}),o=e(m.prototype,"display",[k],{enumerable:!0,initializer:function(){return!1}}),l=m))||l)),a("Results",p)}}}),function(){var a=System.amdDefine;a("component/search.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div class="container" keydown.delegate="handleKeyDown($event)">\n    <div id="custom-search-input">\n      <div class="input-group">\n        <input\n          type="text"\n          class="form-control input-lg"\n          placeholder="Search"\n          value.bind="input & debounce"\n          click.delegate="handleClickForInputField($event)"\n          focus.bind="hasFocus"\n        />\n        <span class="input-group-btn">\n          <button class="btn" type="button">\n              <i class="fa fa-search"></i>\n          </button>\n        </span>\n      </div>\n      <results\n        view-model.ref="resultsElement"\n        dataset.bind="results"\n      ></results>\n    </div>\n  </div>\n</template>\n'})}(),System.register("component/search.js",["aurelia-framework","aurelia-api","aurelia-router","aurelia-pal"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return{setters:[function(a){f=a.inject,g=a.customElement,h=a.bindable,i=a.observable,j=a.bindingMode},function(a){k=a.Endpoint},function(a){l=a.Router},function(a){m=a.DOM}],execute:function(){a("Search",(n=g("search"),o=f(k.of("api"),l),p=h(),q=i(),r=h({defaultBindingMode:j.twoWay}),x=n(s=o((t=function(){function a(b,e){d(this,a),c(this,"options",u,this),c(this,"input",v,this),c(this,"results",w,this),this.hasFocus=!0,this.bodyElement=null,this.resultsElement=null,this.apiEndpoint=b,this.router=e}return a.prototype.resultsChanged=function(){this.focus()},a.prototype.inputChanged=function(){return this.input?void this.doSearch():void this.resetResults()},a.prototype.resetResults=function(){this.results=[]},a.prototype.focus=function(){this.hasFocus=!0},a.prototype.unfocus=function(){this.hasFocus=!1},a.prototype.doSearch=function(){var a=this;this.apiEndpoint.find("search?q="+this.input).then(function(b){a.results=b}).catch(function(a){console.error(a)})},a.prototype.attached=function(){this.bodyElement=m.querySelectorAll("body")[0],this.listenToClickEvent(),this.listenToDoubleClickEvent()},a.prototype.detached=function(){this.removeClickEventListener(),this.removeDoubleClickEventListener()},a.prototype.listenToDoubleClickEvent=function(){var a=this;this.doubleClickEventListener=this.bodyElement.addEventListener("dblclick",function(){return a.handlePageClickEvent()})},a.prototype.removeDoubleClickEventListener=function(){this.bodyElement.removeEventListener("dblclick",this.doubleClickEventListener)},a.prototype.listenToClickEvent=function(){var a=this;this.clickEventListener=this.bodyElement.addEventListener("click",function(){return a.handlePageClickEvent()})},a.prototype.removeClickEventListener=function(){this.bodyElement.removeEventListener("click",this.clickEventListener)},a.prototype.getLinkForSelectedItem=function(){var a=this.resultsElement.getSelectedItemIndex()>=0?this.resultsElement.getSelectedItemIndex():0;return"station/"+this.results[a]._source.stationID},a.prototype.redirectToSelectedSearchResult=function(){this.router.navigate(this.getLinkForSelectedItem())},a.prototype.handleArrowDown=function(){return this.results.length?!(this.resultsElement.getSelectedItemIndex()+1>=this.results.length)&&(this.unfocus(),this.resultsElement.selectNextItem(),!1):(this.resultsElement.resetSelection(),!1)},a.prototype.handleArrowUp=function(){return this.results.length?this.resultsElement.getSelectedItemIndex()-1<0?(this.focus(),this.resultsElement.resetSelection(),!1):(this.unfocus(),this.resultsElement.selectPreviousItem(),!1):(this.resultsElement.resetSelection(),!1)},a.prototype.handleEnter=function(){return!!this.results.length&&(this.redirectToSelectedSearchResult(),this.resultsElement.hide(),this.resultsElement.resetSelection(),this.focus(),!0)},a.prototype.handleEscape=function(){return this.resultsElement.resetSelection(),this.unfocus(),this.resultsElement.hide(),!1},a.prototype.handleDefault=function(){return this.resultsElement.show(),!0},a.prototype.handlePageClickEvent=function(){return this.resultsElement.hide(),!0},a.prototype.handleClickForInputField=function(){return this.resultsElement.resetSelection(),this.focus(),this.resultsElement.show(),!1},a.prototype.handleKeyDown=function(a){var b=!0;switch(a.key){case"Escape":b=this.handleEscape();break;case"Enter":b=this.handleEnter();break;case"ArrowUp":b=this.handleArrowUp();break;case"ArrowDown":b=this.handleArrowDown();break;default:b=this.handleDefault()}return b},a}(),u=e(t.prototype,"options",[p],{enumerable:!0,initializer:function(){return null}}),v=e(t.prototype,"input",[q],{enumerable:!0,initializer:function(){return null}}),w=e(t.prototype,"results",[r],{enumerable:!0,initializer:function(){return[]}}),s=t))||s)||s)),a("Search",x)}}}),function(){var a=System.amdDefine;a("component/tooltip.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div\n    id="tooltip-container"\n    element.ref="tooltipContainer"\n    show.bind="_show"\n    css="top: ${top}px; left: ${left}px;"\n  >\n    <div>\n      <span class="tooltip-key" if.bind="key">${key}</span>\n      <span class="tooltip-value" if.bind="value">${value}</span>\n    </div>\n  </div>\n</template>\n'})}(),System.register("component/tooltip.js",["aurelia-framework","aurelia-pal"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k;return{setters:[function(a){d=a.inject,e=a.customElement,f=a.bindable,g=a.observable},function(a){h=a.DOM}],execute:function(){a("Tooltip",(i=e("tooltip"),k=i(j=function(){function a(){c(this,a),this.key=null,this.value=null,this._show=!1,this.tooltipContainer=null}return a.prototype.setValue=function(a){this.key=a},a.prototype.setPosition=function(a,b){return a.x<b/2?(this.top=a.y+15,void(this.left=a.x+15)):(this.top=a.y+15,void(this.left=a.x-this.tooltipContainer.offsetWidth-30))},a.prototype.show=function(){this._show=!0},a.prototype.hide=function(){this._show=!1},a}())||j)),a("Tooltip",k)}}}),System.register("config/routes.js",[],function(a,b){"use strict";return{setters:[],execute:function(){a("default",[{route:"",name:"index",moduleId:"page/index",nav:!0,title:"Home"},{route:"/map",name:"Map",moduleId:"page/map",nav:!0,title:"Map"},{route:"/livecam",name:"Livecam",moduleId:"page/livecam",nav:!0,title:"Livecam"},{route:"/station/:id",name:"station",moduleId:"page/station",nav:!1,title:"Station"},{route:"/404",name:"not-found",moduleId:"page/not-found",nav:!1,title:"404"}])}}}),System.register("config/app.js",[],function(a,b){"use strict";return{setters:[],execute:function(){a("default",{title:"StatsLyon",defaultLocale:{language:"fr",locale:"fr-FR"}})}}}),System.register("main.js",["fetch","intl","config/routes","config/app","i18next-xhr-backend","aurelia-router","aurelia-configuration","bootstrap","font-awesome/css/font-awesome.min.css!text"],function(a,b){"use strict";function c(a){a.use.standardConfiguration().plugin("aurelia-configuration",function(a){a.setEnvironments({staging:["stats-lyon"],development:["localhost"],production:["stats-lyon.fr","www.stats-lyon.fr"]}),a.setDirectory("/scripts"),a.setConfig("app.json")}).plugin("aurelia-api",function(b){var c=a.container.get(i).get("endpoints");c.forEach(function(a){b.registerEndpoint(a.name,a.endpoint,a.config),a.default&&b.setDefaultEndpoint(a.name)})}).plugin("aurelia-notification",function(a){a.configure({translate:!0,notifications:{success:"humane-flatty-success",error:"humane-flatty-error",info:"humane-flatty-info"}})}).plugin("aurelia-i18n",function(a){a.i18next.use(g),a.setup({backend:{loadPath:"scripts/config/locale/{{lng}}/{{ns}}.json"},lng:f.defaultLocale.language,attributes:["t"],fallbackLng:f.defaultLocale.language,debug:!1})}).plugin("aurelia-notification",function(a){a.configure({translate:!0,notifications:{success:"humane-libnotify-success",error:"humane-libnotify-error",info:"humane-libnotify-info"}})}).globalResources("component/search").globalResources("component/datamap").globalResources("component/tooltip").globalResources("component/results").globalResources("component/datapie").globalResources("component/chart").globalResources("tool/floatFormatValueConverter").globalResources("tool/dateFormatValueConverter").globalResources("tool/hourFormatValueConverter").globalResources("tool/titleFormatValueConverter"),a.use.developmentLogging(),a.start().then(function(a){a.container.get(h).configure(d),a.setRoot("app")})}function d(a){a.title=f.title,a.options.pushState=!0,a.options.root="/",a.map(e),a.fallbackRoute("/404")}var e,f,g,h,i;return a("configure",c),{setters:[function(a){},function(a){},function(a){e=a.default},function(a){f=a.default},function(a){g=a.default},function(a){h=a.Router},function(a){i=a.AureliaConfiguration},function(a){},function(a){}],execute:function(){}}}),function(){var a=System.amdDefine;a("page/index.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n\n  <require from="component/datapie"></require>\n\n\n  <div class="container">\n    <search></search>\n  </div>\n\n  <!--<div class="row">-->\n    <!--<div class="col-md-4 col-xs-12">-->\n      <!--<div id="chart"></div>-->\n      <!--&lt;!&ndash; Most used stations &ndash;&gt;-->\n      <!--&lt;!&ndash; github like graph of lastly most used stations &ndash;&gt;-->\n    <!--</div>-->\n    <!--&lt;!&ndash;<div class="col-md-8 col-xs-12">&ndash;&gt;-->\n    <!--&lt;!&ndash;<div class="row flex-items-xs-middle">&ndash;&gt;-->\n    <!--&lt;!&ndash;<datapie class="col-md" percent.bind="percent" name="Availability"></datapie>&ndash;&gt;-->\n    <!--&lt;!&ndash;</div>&ndash;&gt;-->\n    <!--&lt;!&ndash;</div>&ndash;&gt;-->\n    <!--&lt;!&ndash; Global metrics in little cubes &ndash;&gt;-->\n    <!--&lt;!&ndash; Network availability ... &ndash;&gt;-->\n  <!--</div>-->\n\n</template>\n'})}(),System.register("page/index.js",["aurelia-framework","aurelia-api"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i,j,k;return{setters:[function(a){d=a.inject,e=a.customElement,f=a.bindable,g=a.observable},function(a){h=a.Endpoint}],execute:function(){a("Index",(i=d(h.of("api")),k=i(j=function(){function a(b){c(this,a),this.availability=null,this.endpoint=b}return a.prototype.fetchAvailability=function(){var a=this;this.endpoint.find("status/availability").then(function(b){a.availability=b,a.percent=(100*a.availability.value).toFixed(2)}).catch(function(a){console.error(a)})},a.prototype.attached=function(){this.fetchAvailability()},a}())||j)),a("Index",k)}}}),function(){var a=System.amdDefine;a("page/livecam.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div class="container-fluid livecams">\n    <div class="text-xs-center">\n      <img style="width:320px;height:240px;" src.bind="image.url" repeat.for="image of images" />\n    </div>\n  </div>\n</template>\n'})}(),System.register("page/livecam.js",["aurelia-framework","aurelia-api"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h;return{setters:[function(a){d=a.inject},function(a){e=a.Endpoint}],execute:function(){a("Livecam",(f=d(e.of("api")),h=f(g=function(){function a(b){c(this,a),this.images=[],this.ONE_MINUTE=6e4,this.endpoint=b}return a.prototype.fetchLivecams=function(){var a=this;return this.images.length>0?this.timestampImages():void this.endpoint.find("https://download.data.grandlyon.com/ws/rdata/pvo_patrimoine_voirie.pvocameracriter/all.json").then(function(b){a.images=b.values,a.timestampImages()}).catch(function(a){console.error(a)})},a.prototype.timestampImages=function(){this.images.forEach(function(a){
a.url+="?"+ +new Date})},a.prototype.attached=function(){this.fetchLivecams(),this.reloadingInterval=setInterval(this.fetchLivecams.bind(this),this.ONE_MINUTE)},a.prototype.detached=function(){clearInterval(this.reloadingInterval)},a}())||g)),a("Livecam",h)}}}),function(){var a=System.amdDefine;a("page/map.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n\n  <datamap\n    if.bind="dataset && stations"\n    dataset.bind="dataset"\n    stations-stats.bind="stations"\n    file="adrvoielieuadrarrond.json"\n    color-range.bind="colorRange"\n  >\n  </datamap>\n\n</template>\n'})}(),System.register("page/map.js",["aurelia-framework","aurelia-api","moment"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e,f,g,h,i;return{setters:[function(a){d=a.inject},function(a){e=a.Endpoint},function(a){f=a.default}],execute:function(){a("Map",(g=d(e.of("api")),i=g(h=function(){function a(b){c(this,a),this.colorRange=["brown","steelblue"],this.dataset=null,this.stats=null,this.stations=null,this.endpoint=b}return a.prototype.setDataset=function(){this.dataset={title:"Number of stands",data:this.stats,toFetch:"sum.value"}},a.prototype.fetchTowns=function(){var a=this;this.endpoint.find("station/town").then(function(b){a.towns=b,a.fetchStats()}).catch(function(a){console.error(a)})},a.prototype.fetchStationsStats=function(){var a=this,b="status?from="+f().subtract(5,"hours").utc().format()+"&to="+f().utc().format();this.endpoint.find(b).then(function(b){a.stations=b}).catch(function(a){console.error(a)})},a.prototype.fetchStats=function(){var a=this;this.endpoint.post("station/stat",{query:this.towns}).then(function(b){a.stats=b,a.setDataset()}).catch(function(a){console.error(a)})},a.prototype.attached=function(){this.fetchTowns(),this.fetchStationsStats()},a}())||h)),a("Map",i)}}}),function(){var a=System.amdDefine;a("page/not-found.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return"<template>\n  <h4>I don't know where to take you</h4>\n</template>\n"})}(),System.register("page/not-found.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("NotFound",d=function a(){c(this,a)}),a("NotFound",d)}}}),function(){var a=System.amdDefine;a("page/station.html!github:systemjs/plugin-text@0.0.8.js",[],function(){return'<template>\n  <div class="container">\n    <search></search>\n    <h1 class="row m-x-auto flex-items-xs-center" style="margin-top:30px;margin-bottom:30px;color:#286090;">\n      <span class="tag tag-success" style="margin-right:10px;">${id}</span>${data._source.name}\n    </h1>\n    <div class="row">\n      <div class="col-md-8 col-xs-12">\n        <chart view-model.ref="chart" settings.bind="settings"></chart>\n        <form class="form-inline text-center">\n          <div class="form-group">\n            <label>From</label>\n            <input type="date" class="form-control" value.bind="from | dateFormat">\n          </div>\n          <div class="form-group">\n            <label>to</label>\n            <input type="date" class="form-control" value.bind="to | dateFormat">\n          </div>\n        </form>\n      </div>\n      <div class="col-md-4 col-xs-12 flex-xs-middle flex-md-middle">\n        <div class="panel panel-default">\n          <table class="table table-bordered table-striped">\n            <tr>\n              <td>Town</td>\n              <td class="text-center">${data._source.town}</td>\n            </tr>\n            <tr>\n              <td>Bonus</td>\n              <td class="text-center">${data._source.bonus}</td>\n            </tr>\n            <tr>\n              <td>Stands</td>\n              <td class="text-center">${data._source.stands}</td>\n            </tr>\n          </table>\n        </div>\n\n        <div class="panel panel-default">\n          <table class="table table-bordered table-striped">\n            <tr>\n              <td>Minimum</td>\n              <td class="text-center">${stats.min}</td>\n            </tr>\n            <tr>\n              <td>Max</td>\n              <td class="text-center">${stats.max}</td>\n            </tr>\n            <tr>\n              <td>Average</td>\n              <td class="text-center">${stats.avg | floatFormat}</td>\n            </tr>\n          </table>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n'})}(),System.register("page/station.js",["aurelia-framework","aurelia-api","moment","aurelia-notification"],function(a,b){"use strict";function c(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;return{setters:[function(a){f=a.inject,g=a.observable},function(a){h=a.Endpoint},function(a){i=a.default},function(a){j=a.Notification}],execute:function(){a("Station",(k=f(h.of("api"),j),l=g(),m=g(),n=g(),o=g(),p=g(),q=g(),z=k((s=function(){function a(b,e){var f;d(this,a),c(this,"from",t,this),c(this,"to",u,this),c(this,"id",v,this),c(this,"data",w,this),c(this,"statusDataset",x,this),c(this,"stats",y,this),this.chart=null,this.settings={data:{x:"date",columns:[["date"],["Bikes available"],["Stands available"]],colors:(f={},f["Bikes available"]="#FF940D",f["Stands available"]="#14CC3F",f)},axis:{x:{type:"timeseries",extent:null,tick:{format:"%H:%M",count:10,culling:{max:10}}},y:{min:0,padding:{top:10,bottom:4}}},subchart:{show:!0},grid:{lines:{front:!1}}},this.firstLoad=!0,this.FIVE_MINUTE=3e5,this.apiEndpoint=b,this.notification=e}return a.prototype.idChanged=function(){this.loadStation(),this.firstLoad=!0},a.prototype.fromChanged=function(){this.loadStation()},a.prototype.toChanged=function(){this.loadStation()},a.prototype.statsChanged=function(){this.loadGrid()},a.prototype.statusDatasetChanged=function(){this.loadCanvas()},a.prototype.attached=function(){this.chart.create(),this.reloadingInterval=setInterval(this.loadStation.bind(this),this.FIVE_MINUTE)},a.prototype.detached=function(){clearInterval(this.reloadingInterval)},a.prototype.activate=function(a){this.id=a.id},a.prototype.resetSettings=function(){this.settings.data.columns.forEach(function(a){a.splice(1,a.length)})},a.prototype.loadStation=function(){this.firstLoad?this.firstLoad=!1:this.notification.info("Data changed"),this.fetchStationData(),this.fetchStatusData(),this.fetchStats()},a.prototype.addMinimumOnGrid=function(){this.chart.addYGridLine({value:this.stats.min,text:"Minimum"})},a.prototype.addMaximumOnGrid=function(){this.chart.addYGridLine({value:this.stats.max,text:"Maximum"})},a.prototype.addAverageOnGrid=function(){this.chart.addYGridLine({value:this.stats.avg,text:"Average"})},a.prototype.loadGrid=function(){this.chart.removeYGrids(),this.addMinimumOnGrid(),this.addMaximumOnGrid(),this.addAverageOnGrid()},a.prototype.loadData=function(){var a=this;this.resetSettings(),this.statusDataset.forEach(function(b){a.settings.data.columns[0].push(new Date(b._source.createdAt)),a.settings.data.columns[1].push(b._source.availableBikes),a.settings.data.columns[2].push(b._source.availableStands)})},a.prototype.setupExtent=function(){var a=i().subtract(4,"hours").toDate(),b=i().toDate();this.chart.setExtent([a,b])},a.prototype.loadCanvas=function(){this.loadData(),this.chart.reload(),this.setupExtent()},a.prototype.fetchStats=function(){var a=this;this.apiEndpoint.find("status/"+this.id+"/available-stands/").then(function(b){a.stats=b}).catch(function(a){console.error(a)})},a.prototype.fetchStatusData=function(){var a=this;i(this.from).isValid()&&i(this.to).isValid()&&this.apiEndpoint.find("status/"+this.id,{from:i(this.from).utc().format(),to:i(this.to).utc().format()}).then(function(b){a.statusDataset=b}).catch(function(a){console.error(a)})},a.prototype.fetchStationData=function(){var a=this;this.apiEndpoint.find("station/"+this.id).then(function(b){a.data=b}).catch(function(a){console.error(a)})},a}(),t=e(s.prototype,"from",[l],{enumerable:!0,initializer:function(){return i().subtract(2,"hours").format("YYYY-MM-DD")}}),u=e(s.prototype,"to",[m],{enumerable:!0,initializer:function(){return i().add(1,"day").format("YYYY-MM-DD")}}),v=e(s.prototype,"id",[n],{enumerable:!0,initializer:function(){return null}}),w=e(s.prototype,"data",[o],{enumerable:!0,initializer:function(){return{}}}),x=e(s.prototype,"statusDataset",[p],{enumerable:!0,initializer:function(){return[]}}),y=e(s.prototype,"stats",[q],{enumerable:!0,initializer:function(){return{}}}),r=s))||r)),a("Station",z)}}}),System.register("tool/dateFormatValueConverter.js",["moment"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[function(a){d=a.default}],execute:function(){a("dateFormatValueConverter",e=function(){function a(){c(this,a)}return a.prototype.toView=function(a){var b="YYYY-MM-DD";return d.isMoment(a)?a.format(b):d(a).format(b)},a}()),a("dateFormatValueConverter",e)}}}),System.register("tool/floatFormatValueConverter.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("floatFormatValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a){return parseFloat(Math.round(100*a)/100).toFixed(2)},a}()),a("floatFormatValueConverter",d)}}}),System.register("tool/hourFormatValueConverter.js",["moment"],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d,e;return{setters:[function(a){d=a.default}],execute:function(){a("hourFormatValueConverter",e=function(){function a(){c(this,a)}return a.prototype.toView=function(a){var b="HH:mm";return d.isMoment(a)?a.format(b):d(a).format(b)},a}()),a("hourFormatValueConverter",e)}}}),System.register("tool/titleFormatValueConverter.js",[],function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d;return{setters:[],execute:function(){a("titleFormatValueConverter",d=function(){function a(){c(this,a)}return a.prototype.toView=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},a}()),a("titleFormatValueConverter",d)}}});